# Ralph Progress Log
Started: Event Finder with AI-Powered Plugin Generation
Branch: ralph/event-finder
---

## Codebase Patterns
- Run backend with: `python3 -m uvicorn backend.main:app --reload`
- Run mypy typecheck with: `python3 -m mypy backend/ --ignore-missing-imports`
- FastAPI app uses APIRouter with `/api` prefix for all endpoints
- Run frontend with: `cd frontend && npm run dev`
- Run frontend typecheck with: `cd frontend && npx tsc --noEmit`
- Frontend uses Tailwind CSS v4 via @tailwindcss/vite plugin (import with `@import "tailwindcss"`)
- Frontend proxy configured: `/api` routes to backend at localhost:8000
- Backend requires `backend/__init__.py` for mypy to resolve module paths correctly
- Plugin imports use `from backend.models import Event` (full path from project root)
- Plugin loader: use `reload_plugins()` after adding new plugins to refresh registry
- Plugin registry access: `get_plugin_registry()` returns dict[name, class], `get_plugin_info()` returns API-friendly list
- AI service: use `send_message()` for raw Claude calls, `chat_with_context()` for EventFinder-specific chat
- Chat service: use `process_chat_message(message, conversation_id)` for chat with conversation history management
- Event search: use `scrape_all_plugins()` for concurrent scraping, `is_event_search_request()` for keyword detection
- Plugin generation: use `is_plugin_creation_request()` to detect "create plugin for [URL]" patterns, `create_plugin_for_url()` to generate and save plugins
- Chat UI: POST `/api/chat` with `{ message, conversation_id }` returns `{ response, conversation_id, events }`
- Event cards: import EventCard from `./EventCard` and pass `EventData` objects to render rich event displays
- Frontend components: place in `frontend/src/components/` directory
- PluginPanel: fetches from `/api/plugins`, triggers generation via `/api/chat` with "Create a plugin for [URL]" message

---

## 2026-01-26 - US-001
- Implemented FastAPI backend scaffolding
- Files changed:
  - backend/main.py - FastAPI app with CORS and health endpoint
  - backend/requirements.txt - Dependencies (fastapi, uvicorn, pydantic, anthropic, crawl4ai)
- **Learnings for future iterations:**
  - Use `python3 -m uvicorn` rather than just `uvicorn` if uvicorn is not on PATH
  - FastAPI app is configured with CORS for localhost:5173 (Vite default)
  - Health check at GET /api/health returns {"status": "ok"}
---

## 2026-01-26 - US-002
- Set up React frontend with Vite and TypeScript
- Files changed:
  - frontend/ - New Vite + React + TypeScript project
  - frontend/vite.config.ts - Added Tailwind CSS plugin and proxy to backend
  - frontend/src/index.css - Tailwind CSS import
  - frontend/src/App.tsx - Basic placeholder with Tailwind styling
- **Learnings for future iterations:**
  - Tailwind CSS v4 uses `@import "tailwindcss"` in CSS (no directives like @tailwind base)
  - Use @tailwindcss/vite plugin for Vite integration (not postcss config)
  - Vite proxy config at `server.proxy` maps `/api` to backend localhost:8000
  - TypeScript build command: `tsc -b && vite build` (runs typecheck then build)
---

## 2026-01-26 - US-003
- Defined Event Pydantic model and ScraperPlugin abstract base class
- Files changed:
  - backend/__init__.py - Created to make backend a proper Python package
  - backend/models.py - Event Pydantic model with all required fields
  - backend/plugins/__init__.py - Plugin package init, exports ScraperPlugin
  - backend/plugins/base.py - ScraperPlugin ABC with name, source_url, description attributes, abstract scrape() method, and crawl() helper using AsyncWebCrawler
- **Learnings for future iterations:**
  - Backend needs `__init__.py` for mypy module resolution to work correctly
  - ScraperPlugin subclasses must define name, source_url, description as class attributes
  - crawl() helper returns markdown representation of page from crawl4ai
---

## 2026-01-26 - US-004
- Created Luma scraper plugin implementing ScraperPlugin interface
- Files changed:
  - backend/plugins/luma.py - LumaPlugin class that scrapes events from lu.ma/sf
- **Learnings for future iterations:**
  - ScraperPlugin subclasses use the inherited crawl() method to fetch markdown content
  - Event parsing from markdown requires flexible regex patterns for dates/times/locations
  - Always wrap scrape() in try/except and return empty list on error (log the error)
  - Generate unique event IDs with uuid.uuid4()
  - Luma event links are formatted as [Title](https://lu.ma/...) in markdown output
---

## 2026-01-26 - US-005
- Implemented plugin loader system for dynamic plugin discovery and loading
- Files changed:
  - backend/services/__init__.py - Created services package
  - backend/services/plugin_loader.py - Plugin loader with scan, load, reload, and registry functions
  - backend/main.py - Added /api/plugins endpoint and plugin loading on startup
- **Learnings for future iterations:**
  - Use `importlib.util.spec_from_file_location()` for dynamic module imports
  - Plugin registry is a module-level dict (`_plugin_registry`) for state persistence
  - `get_plugin_info()` returns list of dicts suitable for API responses
  - `reload_plugins()` clears registry and reloads all plugins (useful after plugin generation)
  - Plugins are loaded on app startup via `@app.on_event("startup")` decorator
---

## 2026-01-26 - US-006
- Created Claude AI service for chat and recommendations
- Files changed:
  - backend/services/ai.py - Claude AI service with send_message and chat_with_context functions
- **Learnings for future iterations:**
  - Use `claude-sonnet-4-20250514` model ID for Claude Sonnet
  - Anthropic SDK: `client.messages.create()` returns response with content blocks
  - Handle different error types: AuthenticationError, RateLimitError, APIStatusError, APIError
  - Return user-friendly error messages instead of raising exceptions for recoverable errors
  - ANTHROPIC_API_KEY must be set in environment before using the service
  - MessageDict type alias: `dict[str, str]` with "role" and "content" keys for conversation history
---

## 2026-01-26 - US-007
- Created chat API endpoint with conversation management
- Files changed:
  - backend/services/chat.py - Chat service with conversation storage and processing
  - backend/models.py - Added ChatRequest and ChatResponse Pydantic models
  - backend/main.py - Added POST /api/chat endpoint
- **Learnings for future iterations:**
  - Conversation storage uses module-level dict `_conversations` for in-memory persistence
  - `process_chat_message()` is the main entry point - handles conversation ID generation and history management
  - Chat service imports MessageDict from ai.py to ensure type consistency
  - API returns both response text and conversation_id for frontend to track conversations
---

## 2026-01-26 - US-008
- Implemented event search and recommendation functionality
- Files changed:
  - backend/services/chat.py - Added event search detection, concurrent plugin scraping, and AI recommendations
- **Learnings for future iterations:**
  - `is_event_search_request()` checks for keywords like "find", "search", "events", "hackathons", "meetups", etc.
  - `scrape_all_plugins()` uses `asyncio.gather()` with `return_exceptions=True` to scrape all plugins concurrently
  - `format_events_for_context()` formats Event objects as markdown for Claude's context
  - `search_and_recommend_events()` builds a custom system prompt with event data for AI recommendations
  - Use `send_message()` with custom system prompt for event-specific queries (not `chat_with_context()`)
  - Event search triggers automatically based on keyword detection in user messages
---

## 2026-01-26 - US-009
- Implemented plugin generation capability for dynamic scraper creation
- Files changed:
  - backend/services/chat.py - Added plugin generation detection, URL crawling, code generation with Claude, file saving, and testing
- **Learnings for future iterations:**
  - `is_plugin_creation_request()` uses regex patterns to detect "create plugin for [URL]" and similar phrases
  - `extract_domain_name()` cleans URLs into valid Python filenames (e.g., "lu.ma" -> "lu_ma")
  - `crawl_url_for_structure()` uses AsyncWebCrawler to get page markdown for analysis
  - `get_plugin_template()` provides Claude with a detailed template and requirements for generating valid plugins
  - Generated code must be cleaned (strip markdown code blocks) before saving
  - `test_generated_plugin()` loads and runs the plugin to verify it works before confirming success
  - Always call `reload_plugins()` after successfully generating a plugin to make it immediately available
  - Plugin generation flow: crawl URL -> generate code with Claude -> save to file -> test -> reload registry
---

## 2026-01-26 - US-010
- Created chat UI component with full message functionality
- Files changed:
  - frontend/src/components/Chat.tsx - New chat component with message input, history, loading states
  - frontend/src/App.tsx - Integrated Chat component into main app layout
- **Learnings for future iterations:**
  - Use `crypto.randomUUID()` for generating unique message IDs in the browser
  - `useRef` with `scrollIntoView({ behavior: 'smooth' })` provides auto-scroll functionality
  - Store conversation_id in state to maintain conversation context across messages
  - API endpoint: POST /api/chat with `{ message, conversation_id }` returns `{ response, conversation_id }`
  - Tailwind responsive classes: `max-w-[80%] sm:max-w-[70%]` for message bubbles that work on mobile
  - Loading indicator uses CSS `animate-bounce` with staggered `animationDelay` for typing dots effect
  - Input disabled state and button disabled state should both check `isLoading`
---

## 2026-01-26 - US-011
- Created EventCard component for displaying events as rich cards in chat
- Files changed:
  - frontend/src/components/EventCard.tsx - New component with title, date/time, location, source badge
  - frontend/src/components/Chat.tsx - Updated to render EventCard components from message events
  - frontend/package.json - Added lucide-react for icons
  - backend/models.py - Added EventResponse model for API responses
  - backend/services/chat.py - Updated to return events array in chat responses
- **Learnings for future iterations:**
  - Use lucide-react for icons (Calendar, Clock, MapPin, ExternalLink)
  - EventCard is clickable - uses `window.open(url, '_blank', 'noopener,noreferrer')` for security
  - Source badges are color-coded using a mapping object (`sourceColors`)
  - Chat API now returns `{ response, conversation_id, events }` where events is array of EventData
  - Event dates are serialized as ISO strings from backend, formatted with `toLocaleDateString()` in frontend
  - Cards render inline within message bubbles by checking `message.events && message.events.length > 0`
  - `search_and_recommend_events()` now returns tuple of (response, events) instead of just response
---

## 2026-01-26 - US-012
- Added plugin management sidebar with modal for plugin generation
- Files changed:
  - frontend/src/components/PluginPanel.tsx - New sidebar component with plugin list, refresh, and generation modal
  - frontend/src/App.tsx - Updated layout to include PluginPanel sidebar alongside Chat
- **Learnings for future iterations:**
  - PluginPanel fetches plugins from GET /api/plugins on mount and after generation
  - Plugin generation uses POST /api/chat with "Create a plugin for [URL]" message pattern
  - Modal state management: showModal, isGenerating, generationError, generationSuccess
  - Responsive layout: sidebar hidden on mobile (`hidden lg:block`), uses `w-80 flex-shrink-0`
  - Main chat area uses `flex-1 min-w-0` to allow proper shrinking in flexbox
  - Lucide icons: Plug, Plus, RefreshCw, ExternalLink, X for consistent UI
  - Success/error states shown in modal with colored backgrounds (green-50/red-50)
  - Auto-close modal after 2 seconds on successful generation using setTimeout
---
